<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas width="500" height="500"></canvas>

<script type="module">
  async function draw (gl, rate, color) {
    if (color >= 1 || color < 0) {
      rate = -1 * rate
    }
    color = 0.01 * rate + color
    const { GLShader } = await import('../../lib/gl-tool.js')
    const shader = new GLShader(gl, {
      color
    })
    const program = gl.createProgram()
    gl.attachShader(program, shader.vertexShader)
    gl.attachShader(program, shader.fragmentShader)
    gl.linkProgram(program)
    gl.useProgram(program)

    // 缓冲区
    const points = new Float32Array([-1, 1, -1,-1,  1,-1, 1,1])
    const bufferId = gl.createBuffer()
    gl.bindBuffer(gl.ARRAY_BUFFER, bufferId)
    gl.bufferData(gl.ARRAY_BUFFER, points, gl.STATIC_DRAW)

    // 将数据读取至GPU
    const vPosition = gl.getAttribLocation(program, 'position')
    gl.vertexAttribPointer(vPosition, 2, gl.FLOAT, false, 0, 0)
    gl.enableVertexAttribArray(vPosition)

    // 绘制
    gl.clear(gl.COLOR_BUFFER_BIT)
    gl.drawArrays(gl.TRIANGLE_FAN, 0, points.length / 2)
    requestAnimationFrame(() => draw(gl, rate, color))
  }
  {
    const canvas = document.querySelector('canvas')
    const gl = canvas.getContext('webgl')
    let color = 0.5
    let rate = 1
    requestAnimationFrame(() => draw(gl, rate, color))
  }
</script>
</body>
</html>
